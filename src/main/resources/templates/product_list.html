<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: html}">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
  <th:block th:fragment="css">
    <link rel="stylesheet" th:href="@{/css/product_list.css}">
  </th:block>
</head>
<body>
<th:block th:fragment="content">
    <div class="product_list-container">
        <div class="product-list-head">
            <div class="product-font list-head">
              <h2 class="product-h2">ìƒí’ˆ ëª©ë¡</h2>
            </div>
            <div class="product-list-right">
                <div class="product-list-search">
                    <input type="text" name="search" id="search" placeholder="ê²€ìƒ‰">
                    <img th:src="@{/local-images/search-icon.png}" onclick="searchBtn()" class="search-icon"/>
                </div>
                <div class="sortAll list-head">
                    <select id="sort" name="sort" onchange="changeSort()" required="required">
                        <option value="latest" th:selected="${sort == 'latest'}">ìµœì‹  ìˆœ</option>
                        <option value="viewst" th:selected="${sort == 'viewst'}">ì¡°íšŒ ìˆœ</option>
                        <option value="salest" th:selected="${sort == 'salest'}">íŒë§¤ ìˆœ</option>
                        <option value="likest" th:selected="${sort == 'likest'}">ì°œí•˜ê¸° ìˆœ</option>
                    </select>
                </div>
            </div>
        </div>
      <div class="product-list">
      <!-- content = í˜„ì¬ í˜ì´ì§€ì— í¬í•¨ëœ ì‹¤ì œ ê°¯ìˆ˜ ë§Œí¼ ë°˜ë³µ   (ì‹¤ì œ ë°ì´í„°(ìƒí’ˆ ëª©ë¡)ê°€ ë‹´ê²¨ ìˆëŠ” í•„ë“œ) -->
          <div class="product-item" th:each="product : ${productPage.content}">
              <a th:href="@{|/productDetail/${product.product_idx}|}">
                <div class="product-image">
                    <img th:src="@{${'/product-images/' + product.product_image.split(',')[0]}}" alt="ìƒí’ˆ ì´ë¯¸ì§€"> <!-- ì²« ë²ˆì§¸ ì´ë¯¸ì§€ -->
                </div>
              </a>
              <div class="product-info">
                  <span class="like">
                            <span>â¤ï¸</span>
                            <span class="product-like-count" th:text="${product.product_like}"></span>
                    </span>
                  <span class="comment">
                            <span>ğŸ’¬</span>
                            <span th:text="${product.product_coment}"></span>
                    </span>
              </div>
              <div class="product-name">
                 <p th:text="${product.productName}">ìƒí’ˆ ì´ë¦„</p>
              </div>
              <div class="product-price">
                  <div th:text="${#numbers.formatInteger(product.product_price, 3, 'COMMA') + ' ì›'}"></div>
              </div>
          </div>
          <div th:if="${#lists.isEmpty(productPage)}" class="no-reviews">
              ì•„ì§ ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.
          </div>
      </div>
      <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ ì¶”ê°€ -->
      <div class="pagination">
          <ul>
              <li th:if="${productPage.hasPrevious()}">
                  <a th:href="@{/product_list(page=${productPage.number - 1}, sort=${sort})}">ì´ì „</a>
              </li>

              <li th:each="i : ${#numbers.sequence(0, productPage.totalPages - 1)}">
                  <a th:href="@{/product_list(page=${i}, sort=${sort})}" th:text="${i + 1}"
                   th:classappend="${i == productPage.number ? 'active' : ''}"></a>
              </li>

              <li th:if="${productPage.hasNext()}">
                 <a th:href="@{/product_list(page=${productPage.number + 1}, sort=${sort})}">ë‹¤ìŒ</a>
              </li>
          </ul>
      </div>
    </div>
</th:block>
</body>
</html>
<script>
  // í˜ì´ì§€ ë¡œë“œ ì‹œ ì €ì¥ëœ ì •ë ¬ ê°’ ì ìš©
  document.addEventListener("DOMContentLoaded", function () {
    const sortSelect = document.getElementById("sort");
    const inputsearch = document.getElementById("search");

    // URLì—ì„œ ê²€ìƒ‰ì–´(search)ì™€ ì •ë ¬ê°’(sort)ì„ ê°€ì ¸ì˜´
    const urlParams = new URLSearchParams(window.location.search);
    const urlSearch = urlParams.get("search"); // URLì—ì„œ search ê°’ ê°€ì ¸ì˜¤ê¸°
    const urlSort = urlParams.get("sort"); // URLì—ì„œ sort ê°’ ê°€ì ¸ì˜¤ê¸°

    // URLì—ì„œ search ê°’ì´ ìˆìœ¼ë©´ inputì— ì„¤ì •í•˜ê³ , ì—†ìœ¼ë©´ ë¹„ì›Œë‘ 
    if (urlSearch) {
      inputsearch.value = urlSearch;
    } else {
      inputsearch.value = ""; // ê²€ìƒ‰ì–´ê°€ ì—†ë‹¤ë©´ ë¹„ì›Œë‘ 
    }

    // URLì—ì„œ sort ê°’ì´ ìˆìœ¼ë©´ ë“œë¡­ë‹¤ìš´ì— ì„¤ì •í•˜ê³ , ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì„¤ì •
    if (urlSort) {
      sortSelect.value = urlSort;
    } else {
      sortSelect.value = "latest"; // ê¸°ë³¸ê°’ ì„¤ì •
    }
  });

  // ì„ íƒí•œ ê°’ URLë¡œ ë³´ë‚´ê¸°
  function changeSort() {
    let selectedSort = document.getElementById("sort").value;
    let currentUrl = new URL(window.location.href);
    let searchValue = document.getElementById("search").value;

    currentUrl.searchParams.set("sort", selectedSort);  // sort íŒŒë¼ë¯¸í„° ì¶”ê°€ ë˜ëŠ” ë³€ê²½
    currentUrl.searchParams.set("page", 0); // ì •ë ¬ ë³€ê²½ ì‹œ ì²« í˜ì´ì§€ë¡œ ì´ë™

    if (searchValue) {
      currentUrl.searchParams.set("search", searchValue); // ê²€ìƒ‰ì–´ê°€ ìˆìœ¼ë©´ ìœ ì§€
    }

    window.location.href = currentUrl.toString(); // ìƒˆ URLë¡œ ì´ë™

  }

  //ê²€ìƒ‰í•œ ê°’ ë³´ë‚´ê¸°
  function searchBtn(){
    let searchValue = document.getElementById("search").value.trim();

    if(searchValue){
      const url = new URL(window.location);
      url.searchParams.set("search",searchValue);
      window.location.href = url.toString();
    }
  }
  // ğŸ”¹ ì—”í„° í‚¤ ê°ì§€ ì´ë²¤íŠ¸ ì¶”ê°€
  document.getElementById("search").addEventListener("keyup", function (event) {
    if (event.key === "Enter") { // ì—”í„° í‚¤ ê°ì§€
      searchBtn(); // ê²€ìƒ‰ ì‹¤í–‰
    }
  });



</script>